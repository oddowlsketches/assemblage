[build]
  base = "assemblage-web"
  command = "cd .. && npm ci && cd assemblage-web && npm ci && npm run build" # Install root deps, then web deps, then build web
  publish = "dist"
  functions = "../netlify/functions"

[build.environment]
  NODE_VERSION = "18"

[dev]
  command = "npm run dev"
  port = 8888
  functions = "../netlify/functions"
  targetPort = 5174  # Updated to match Vite's port
  publish = "assemblage-web/dist"

# Increase timeout for the metadata generation function
[functions."generate-image-metadata"]
  timeout = 60 # seconds
  memory = 1024 # MB

# Increase timeout for the batch update background function
[functions."batch-update-metadata-bg"]
  timeout = 600 # seconds (10 minutes)
  memory = 1024 # MB

# Configure upload function for larger payloads
[functions."upload-and-process-image"]
  timeout = 60 # seconds
  maxRequestBodySize = 10 # MB
  memory = 2048 # MB

# Enable more verbose logging
[dev.environment]
  NODE_ENV = "development"
  DEBUG = "netlify:*"

# Configure function serving
[functions]
  node_bundler = "esbuild"
  external_node_modules = ["sharp"] 